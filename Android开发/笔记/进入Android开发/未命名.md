# Activity 简介



Activity类是 Android 应用的关键组件，而 Activity 的启动和组合方式则是该平台应用模型的基本组成部分。在编程范式中，应用是通过 `main()` 方法启动的，而 Android 系统与此不同，它会调用与其生命周期特定阶段相对应的特定回调方法来启动 `[Activity](https://developer.android.com/reference/android/app/Activity?hl=zh-cn)` 实例中的代码。

本文介绍了 Activity 的概念，并提供了有关如何使用 Activity 的简要说明。要详细了解有关设计应用架构的最佳做法，请参阅[应用架构指南](https://developer.android.com/topic/libraries/architecture/guide?hl=zh-cn)。

## Activity 的概念

移动应用体验与桌面体验的不同之处在于，用户与应用的互动并不总是在同一位置开始，而是经常以不确定的方式开始。例如，如果您从主屏幕打开电子邮件应用，可能会看到电子邮件列表，如果您通过社交媒体应用启动电子邮件应用，则可能会直接进入电子邮件应用的邮件撰写界面。

`[Activity](https://developer.android.com/reference/android/app/Activity?hl=zh-cn)` 类的目的就是促进这种范式的实现。当一个应用调用另一个应用时，调用方应用会调用另一个应用中的 Activity，而不是整个应用。通过这种方式，Activity 充当了应用与用户互动的入口点。您可以将 Activity 实现为 `[Activity](https://developer.android.com/reference/android/app/Activity?hl=zh-cn)` 类的子类。

Activity 提供窗口供应用在其中绘制界面。此窗口通常会填满屏幕，但也可能比屏幕小，并浮动在其他窗口上面。通常，一个 Activity 实现应用中的一个屏幕。例如，应用中的一个 Activity 实现“偏好设置”屏幕，而另一个 Activity 实现“选择照片”屏幕。

大多数应用包含多个屏幕，这意味着它们包含多个 Activity。通常，应用中的一个 Activity 会被指定为主 Activity，这是用户启动应用时出现的第一个屏幕。然后，每个 Activity 可以启动另一个 Activity，以执行不同的操作。例如，一个简单的电子邮件应用中的主 Activity 可能会提供显示电子邮件收件箱的屏幕。主 Activity 可能会从该屏幕启动其他 Activity，以提供执行写邮件和打开邮件这类任务的屏幕。

虽然应用中的各个 Activity 协同工作形成统一的用户体验，但每个 Activity 与其他 Activity 之间只存在松散的关联，应用内不同 Activity 之间的依赖关系通常很小。事实上，Activity 经常会启动属于其他应用的 Activity。例如，浏览器应用可能会启动社交媒体应用的“分享”Activity。

要在应用中使用 Activity，您必须在应用的清单中注册关于 Activity 的信息，并且必须适当地管理 Activity 的生命周期。本文的后续内容将介绍这些主题。

## 配置清单

要使应用能够使用 Activity，您必须在清单中声明 Activity 及其特定属性。

### 声明 Activity

要声明 Activity，请打开清单文件，并添加 [<activity>](https://developer.android.com/guide/topics/manifest/activity-element?hl=zh-cn) 元素作为 [<application>](https://developer.android.com/guide/topics/manifest/application-element?hl=zh-cn) 元素的子元素。例如：

    <manifest ... >      <application ... >          <activity android:name=".ExampleActivity" />          ...      </application ... >      ...    </manifest >    

此元素唯一的必要属性是 [android:name](https://developer.android.com/guide/topics/manifest/activity-element?hl=zh-cn#nm)，该属性用于指定 Activity 的类名称。您也可以添加用于定义标签、图标或界面主题等 Activity 特征的属性。如需详细了解上述及其他属性，请参阅 [<activity>](https://developer.android.com/guide/topics/manifest/activity-element?hl=zh-cn) 元素参考文档。

**注意**：发布应用后，就不应再更改 Activity 名称，否则可能会破坏某些功能，例如应用快捷方式。如需详细了解发布后应避免的更改，请参阅[不可更改的内容](http://android-developers.blogspot.com/2011/06/things-that-cannot-change.html)。

### 声明 intent 过滤器

[Intent 过滤器](https://developer.android.com/guide/components/intents-filters?hl=zh-cn)是 Android 平台的一项非常强大的功能。借助这项功能，您不但可以根据显式请求启动 Activity，还可以根据隐式请求启动 Activity。例如，显式请求可能会告诉系统“在 Gmail 应用中启动‘发送电子邮件’Activity”，而隐式请求可能会告诉系统“在任何能够完成此工作的 Activity 中启动‘发送电子邮件’屏幕”。当系统界面询问用户使用哪个应用来执行任务时，这就是 intent 过滤器在起作用。

要使用此功能，您需要在 [<activity>](https://developer.android.com/guide/topics/manifest/activity-element?hl=zh-cn) 元素中声明 [<intent-filter>](https://developer.android.com/guide/topics/manifest/intent-filter-element?hl=zh-cn) 属性。此元素的定义包括 [<action>](https://developer.android.com/guide/topics/manifest/action-element?hl=zh-cn) 元素，以及可选的 [<category>](https://developer.android.com/guide/topics/manifest/category-element?hl=zh-cn) 元素和/或 [<data>](https://developer.android.com/guide/topics/manifest/data-element?hl=zh-cn) 元素。这些元素组合在一起，可以指定 Activity 能够响应的 intent 类型。例如，以下代码段展示了如何配置一个发送文本数据并接收其他 Activity 的文本数据发送请求的 Activity：

    <activity android:name=".ExampleActivity" android:icon="@drawable/app_icon">        <intent-filter>            <action android:name="android.intent.action.SEND" />            <category android:name="android.intent.category.DEFAULT" />            <data android:mimeType="text/plain" />        </intent-filter>    </activity>    

在此示例中，[<action>](https://developer.android.com/guide/topics/manifest/action-element?hl=zh-cn) 元素指定该 Activity 会发送数据。将 [<category>](https://developer.android.com/guide/topics/manifest/category-element?hl=zh-cn) 元素声明为 `DEFAULT` 可使 Activity 能够接收启动请求。[<data>](https://developer.android.com/guide/topics/manifest/data-element?hl=zh-cn) 元素指定此 Activity 可以发送的数据类型。以下代码段展示了如何调用上述 Activity：

[Kotlin](https://developer.android.com/guide/components/activities/intro-activities?hl=zh-cn#kotlin)[Java](https://developer.android.com/guide/components/activities/intro-activities?hl=zh-cn#java)

    val sendIntent = Intent().apply {        action = Intent.ACTION_SEND  
        type = "text/plain"        putExtra(Intent.EXTRA_TEXT, textMessage)    }    startActivity(sendIntent)    

如果您打算构建一个独立的应用，不允许其他应用激活其 Activity，则不需要任何其他 intent 过滤器。您不想让其他应用访问的 Activity 不应包含 intent 过滤器，您可以自己使用显式 intent 启动它们。如需详细了解 Activity 如何响应 Intent，请参阅 [Intent 和 Intent 过滤器](https://developer.android.com/guide/components/intents-filters?hl=zh-cn)。

### 声明权限

您可以使用清单的 [`<activity>`](https://developer.android.com/guide/topics/manifest/activity-element?hl=zh-cn) 标记来控制哪些应用可以启动某个 Activity。父 Activity 和子 Activity 必须在其清单中具有相同的权限，前者才能启动后者。如果您为父 Activity 声明了 [`<uses-permission>`](https://developer.android.com/guide/topics/manifest/uses-permission-element?hl=zh-cn) 元素，则每个子 Activity 都必须具有匹配的 [`<uses-permission>`](https://developer.android.com/guide/topics/manifest/uses-permission-element?hl=zh-cn)元素。

例如，假设您的应用想要使用一个名为 SocialApp 的应用在社交媒体上分享文章，则 SocialApp 本身必须定义调用它的应用所需具备的权限：

    <manifest>    <activity android:name="...."       android:permission=”com.google.socialapp.permission.SHARE_POST”    />    

然后，为了能够调用 SocialApp，您的应用必须匹配 SocialApp 清单中设置的权限：

    <manifest>       <uses-permission android:name="com.google.socialapp.permission.SHARE_POST" />    </manifest>    

如需详细了解权限和安全性，请参阅[安全性和权限](https://developer.android.com/guide/topics/security/security?hl=zh-cn)。

## 管理 Activity 生命周期

一个 Activity 在其生命周期中会经历多种状态。您可以使用一系列回调来处理状态之间的转换。下面几节将介绍这些回调。

### onCreate()

您必须实现此回调，它会在系统创建您的 Activity 时触发。您的实现应该初始化 Activity 的基本组件：例如，您的应用应该在此处创建视图并将数据绑定到列表。最重要的是，您必须在此处调用 `[setContentView()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#setContentView(android.view.View))` 来定义 Activity 界面的布局。

`[onCreate()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onCreate(android.os.Bundle))` 完成后，下一个回调将是 `[onStart()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onStart())`。

### onStart()

`[onCreate()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onCreate(android.os.Bundle))` 退出后，Activity 将进入“已启动”状态，并对用户可见。此回调包含 Activity 进入前台与用户进行互动之前的最后准备工作。

### onResume()

系统会在 Activity 开始与用户互动之前调用此回调。此时，该 Activity 位于 Activity 堆栈的顶部，并会捕获所有用户输入。应用的大部分核心功能都是在 `[onResume()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onResume())` 方法中实现的。

`[onResume()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onResume())` 回调后面总是跟着 `[onPause()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onPause())` 回调。

### onPause()

当 Activity 失去焦点并进入“已暂停”状态时，系统就会调用 `[onPause()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onPause())`。例如，当用户点按“返回”或“最近使用的应用”按钮时，就会出现此状态。当系统为您的 Activity 调用 `[onPause()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onPause())` 时，从技术上来说，这意味着您的 Activity 仍然部分可见，但大多数情况下，这表明用户正在离开该 Activity，该 Activity 很快将进入“已停止”或“已恢复”状态。

如果用户希望界面继续更新，则处于“已暂停”状态的 Activity 也可以继续更新界面。例如，显示导航地图屏幕或播放媒体播放器的 Activity 就属于此类 Activity。即使此类 Activity 失去了焦点，用户仍希望其界面继续更新。

您**不**应使用 `[onPause()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onPause())` 来保存应用或用户数据、进行网络呼叫或执行数据库事务。有关保存数据的信息，请参阅[保存和恢复 Activity 状态](https://developer.android.com/guide/components/activities/activity-lifecycle?hl=zh-cn#saras)。

`[onPause()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onPause())` 执行完毕后，下一个回调为 `[onStop()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onStop())`或 `[onResume()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onResume())`，具体取决于 Activity 进入“已暂停”状态后发生的情况。

### onStop()

当 Activity 对用户不再可见时，系统会调用 `[onStop()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onStop())`。出现这种情况的原因可能是 Activity 被销毁，新的 Activity 启动，或者现有的 Activity 正在进入“已恢复”状态并覆盖了已停止的 Activity。在所有这些情况下，停止的 Activity 都将完全不再可见。

系统调用的下一个回调将是 `[onRestart()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onRestart())`（如果 Activity 重新与用户互动）或者 `[onDestroy()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onDestroy())`（如果 Activity 彻底终止）。

### onRestart()

当处于“已停止”状态的 Activity 即将重启时，系统就会调用此回调。`[onRestart()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onRestart())` 会从 Activity 停止时的状态恢复 Activity。

此回调后面总是跟着 `[onStart()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onStart())`。

### onDestroy()

系统会在销毁 Activity 之前调用此回调。

此回调是 Activity 接收的最后一个回调。通常，实现 `[onDestroy()](https://developer.android.com/reference/android/app/Activity?hl=zh-cn#onDestroy())` 是为了确保在销毁 Activity 或包含该 Activity 的进程时释放该 Activity 的所有资源。

本部分只是简要地介绍了该主题。有关 Activity 生命周期及其回调的详细说明，请参阅 [Activity 生命周期](https://developer.android.com/guide/components/activities/activity-lifecycle?hl=zh-cn)。